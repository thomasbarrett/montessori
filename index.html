<!DOCTYPE HTML>    
<html>    
    
    <head>    
        <style>  
        * {
    -webkit-print-color-adjust: exact !important;   /* Chrome, Safari, Edge */
    color-adjust: exact !important;                 /*Firefox*/
}  
        #drag-zone {    
            height: 100px;    
            padding: 10px;  
            display: flex;
            justify-content: center;
            align-items: center;  
            margin: 0 auto;    
            border: 1px solid black;    
        }    
           
        .card {
            width: 3in;
            height: 3in;
            padding: 16px;
            border: 1px solid black;    
        }

        .img {
            width: 100%;
            height: 100%;
            background-position: center; 
            background-size: cover;
            border-radius: 8px;
            overflow: hidden;
        }

        #gallery {
            display: flex;
            flex-wrap: wrap;
        }

        body {    
            text-align: center;    
        }    

        @media print {
            #drag-zone {
                display: none;
            }
        }
        </style>    
    </head>    
    <script src="./heic2any.js"></script>
    <body>    
        <div id="drag-zone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)">
            <p>Drag and drop your files here!</p>
        </div>
        <div id="gallery"></div>    
        <script>    
            function handleDragOver(event) {    
                event.preventDefault();  
            }    
  
            function handleDrop(ev)  {    
                event.preventDefault();    
                let dt = event.dataTransfer;
                let files = dt.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                files = [...files]
                files.forEach((file) => {
                    if (file.type === "image/heic") {
                        previewHEIC(file)
                    } else {
                        previewFile(file);
                    }
                })
            }

            function previewHEIC(file) {
                heic2any({
                    blob: file,
                    toType: "image/png",
                })
                .then(function (resultBlob) {
                    var url = URL.createObjectURL(resultBlob);
                    let card = document.createElement('div')
                    card.classList.add('card');
                    let img = document.createElement('div')
                    img.style.backgroundImage =  `url('${url}')`;
                    img.classList.add('img');
                    card.appendChild(img);
                    document.getElementById('gallery').appendChild(card)
                })
            }
            function previewFile(file) {
                let reader = new FileReader()
                reader.readAsDataURL(file)
                reader.onloadend = function() {
                    let card = document.createElement('div')
                    card.classList.add('card');
                    let img = document.createElement('div')
                    img.style.backgroundImage =  `url('${reader.result}')`;
                    img.classList.add('img');
                    card.appendChild(img);
                    document.getElementById('gallery').appendChild(card)
                }
            }
    </script>      
</html>